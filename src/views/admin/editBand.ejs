<!DOCTYPE html>
<html>

<%- include('../partials/head',{ title : 'ADMIN' }) %>

    <body>
        <%- include('../partials/header') %>

            <main class="container">
                <div class="row">
                    <div class="col-md-8 mx-auto">
                        <form id="editBandForm" action="/products/edit/band/<%= band.id %>?_method=PUT" method="POST"
                            enctype="multipart/form-data">
                            <div class="mb-3">
                                <label for="name" class="form-label">Nombre de la Banda</label>
                                <input type="text"
                                    class="form-control <%= locals.errors && (errors.name && 'is-invalid') %>" id="name"
                                    name="name" value="<%= band.name %>">
                                <small id="msgError-name" class="ms-2 text-danger">
                                    <%= locals.errors && (errors.name && errors.name.msg) %>
                                </small>
                            </div>

                            <div class="mb-3">
                                <label for="categoryId" class="form-label">Categoría</label>
                                <select class="form-select" aria-label="Default select example" name="categoryId"
                                    id="categoryId">
                                    <% categories.forEach(category=> { %>
                                        <option <%=category.id===band.categoryId ? 'selected' : '' %> value="<%=
                                                category.id %>"><%= category.name %>
                                        </option>
                                        <% }) %>
                                </select>

                            </div>
                            <div class="mb-3">
                                <label for="phrase" class="form-label">Frase</label>
                                <input type="text"
                                    class="form-control <%= locals.errors && (errors.phrase && 'is-invalid') %>"
                                    id="phrase" name="phrase" value="<%= band.phrase %>">
                                <small id="msgError-phrase" class="ms-2 text-danger">
                                    <%= locals.errors && (errors.phrase && errors.phrase.msg) %>
                                </small>
                            </div>
                            <div class="mb-3">
                                <label for="dateFounded" class="form-label">Año de fundación</label>
                                <input type="number"
                                    class="form-control <%= locals.errors && (errors.dateFounded && 'is-invalid') %>"
                                    id="dateFounded" name="dateFounded" value="<%= band.dateFounded %>">
                                <small id="msgError-dateFounded" class="ms-2 text-danger">
                                    <%= locals.errors && (errors.dateFounded && errors.dateFounded.msg) %>
                                </small>
                            </div>
                            <div class="mb-3">
                                <label for="dateEnded" class="form-label">Año de finalización</label>
                                <input type="number" class="form-control" id="dateEnded" name="dateEnded"
                                    value="<%= band.dateEnded ? band.dateEnded : 0 %>">
                            </div>
                            <div class="mb-3">
                                <label for="vigente" class="form-label">Banda Vigente</label>
                                <input type="checkbox" id="vigente" name="vigente" <% if (!band.dateEnded) { %>checked<%
                                    } %> onclick="toggleFechaFinalizacion()">
                            </div>
                            <div class="mb-3">
                                <label for="totalShows" class="form-label">Total de Conciertos</label>
                                <input type="number"
                                    class="form-control <%= locals.errors && (errors.totalShows && 'is-invalid') %>"
                                    id="totalShows" name="totalShows" value="<%= band.totalShows %>">
                                <small id="msgError-totalShows" class="ms-2 text-danger">
                                    <%= locals.errors && (errors.totalShows && errors.totalShows.msg) %>
                                </small>
                            </div>
                            <div class="mb-3">
                                <label for="nextShows" class="form-label">Próximo Concierto</label>
                                <input type="date"
                                    class="form-control <%= locals.errors && (errors.nextShows && 'is-invalid') %>"
                                    id="nextShows" name="nextShows" value="<%= band.nextShows %>">
                                <small id="msgError-nextShows" class="ms-2 text-danger">
                                    <%= locals.errors && (errors.nextShows && errors.nextShows.msg) %>
                                </small>
                            </div>
                            <div class="mb-3">
                                <label for="history" class="form-label">Historia</label>
                                <textarea class="form-control <%= locals.errors && (errors.history && 'is-invalid') %>"
                                    id="history" name="history" rows="3"><%= band.history %></textarea>
                                <small id="msgError-history" class="ms-2 text-danger">
                                    <%= locals.errors && (errors.history && errors.history.msg) %>
                                </small>
                            </div>
                            <div class="mb-3">
                                <label for="resume" class="form-label">Resumen</label>
                                <textarea class="form-control <%= locals.errors && (errors.resume && 'is-invalid') %>"
                                    id="resume" name="resume" rows="3"><%= band.resume %></textarea>
                                <small id="msgError-resume" class="ms-2 text-danger">
                                    <%= locals.errors && (errors.resume && errors.resume.msg) %>
                                </small>
                            </div>
                            <div class="mb-6">
                                <div class="d-flex flex-column gap-2"><label style="cursor: pointer;">
                                        <img src="/images/bands/<%= band.image %>" width="100px" alt=""></label>
                                </div>
                                <div class="d-flex flex-column gap-2"><label style="cursor: pointer;">
                                        <img src="/images/bands/<%= band.mainImage %>" width="100px" alt=""></label>
                                </div>
                                <label for="mainImage" class="btn btn-secondary">Cambiar imagen de la Banda</label>
                                <input hidden type="file" class="form-control" id="mainImage" name="mainImage">
                                <label for="image" class="btn btn-secondary">Cambiar Logo de la Banda</label>
                                <input hidden type="file" class="form-control" id="image" name="image">
                            </div>
                            <div class="mb-3">
                                <button type="submit" class="btn btn-success">Actualizar</button>
                            </div>
                            <small id="msgError-empty" class="ms-2 text-danger"></small>
                        </form>
                    </div>
                </div>
            </main>


            <script>
                function toggleFechaFinalizacion() {
                    const fechaFinalizacion = document.getElementById("fechaFinalizacion");
                    const vigenteCheckbox = document.getElementById("vigente");

                    if (vigenteCheckbox.checked) {
                        fechaFinalizacion.disabled = true;
                    } else {
                        fechaFinalizacion.disabled = false;
                    }
                }
            </script>
            <script src="/javascripts/editBandFrontendValidations.js"></script>


            <%- include('../partials/footer') %>

    </body>

</html>